<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Server Configuration</title>
<link rel="stylesheet" type="text/css" href="/styles.css">


</head>
<body>
<script>
function updatePackets() {
  // Fetch and update sent packets
  fetch('api/sent-packets')
    .then(response => response.json())
    .then(data => {
      const sentPacketsDiv = document.getElementById('sentPackets');
      sentPacketsDiv.innerHTML = data.map(packet => `<p>Timestamp: ${packet.timestamp}, Direction: ${packet.direction}, Data: ${packet.data}</p>`).join('');
    })
    .catch(error => console.error('Error fetching sent packets:', error));

  // Fetch and update received packets
  fetch('api/received-packets')
    .then(response => response.json())
    .then(data => {
      const receivedPacketsDiv = document.getElementById('receivedPackets');
      receivedPacketsDiv.innerHTML = data.map(packet => `<p>Timestamp: ${packet.timestamp}, Direction: ${packet.direction}, Data: ${packet.data}</p>`).join('');
    })
    .catch(error => console.error('Error fetching received packets:', error));
}

// Update packets every 5 seconds
setInterval(updatePackets, 5000);

// Initial update on page load
document.addEventListener('DOMContentLoaded', updatePackets);
</script>



  
<div class="container">
  <div class="column config">
    <h2>Server Configuration</h2>
    <form id="configurationForm" action="configure" method="post">
      <label>Dongle IP:</label><input type="text" name="dongleIP" value="{{dongleIP}}" required><br>
      <label>Home Assistant IP:</label><input type="text" name="homeAssistantIP" value="{{homeAssistantIP}}" required><br>
      <label>Communicate with Home Assistant</label>
      <select name="sendToHomeAssistant">
        <option value="no" {{selectHaNo}}>No</option>
        <option value="yes" {{selectHaYes}}>Yes</option>
      </select><br>
      <label>Communicate with LUX:</label>
      <select name="sendToLUX">
        <option value="no" {{selectLuxNo}}>No</option>
        <option value="yes" {{selectLuxYes}}>Yes</option>
      </select><br>
      <input type="submit" value="Save Configuration">
    </form>
  </div>
  <div class="column packets">
    <h3>Sent Packets</h3>
    <div id="sentPackets">
      <!-- Dynamically load last 20 sent packets -->
    </div>
  </div>
  <div class="column packets">
    <h3>Received Packets</h3>
    <div id="receivedPackets">
      <!-- Dynamically load last 20 received packets -->
    </div>
  </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const form = document.getElementById('configurationForm');
  form.onsubmit = function(event) {
    event.preventDefault();

    const formData = new FormData(form);
    console.log('Form Data:', formData);

    const object = {};
    formData.forEach((value, key) => { object[key] = value; });
    console.log('Form Object:', object);

    const json = JSON.stringify(object);
    console.log('JSON to be sent:', json);

    fetch('configure', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: json,
    })
    .then(response => {
      console.log('Response received:', response);
      if (response.ok) {
        alert('Configuration saved successfully.');
        window.location.reload(); // Reload to see updated values
      } else {
        alert('Error saving configuration');
      }
    })
    .catch(error => {
      console.error('Error:', error);
      alert('Error saving configuration');
    });
  };
});
</script>

</body>
</html>
